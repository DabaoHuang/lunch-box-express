head
    script(src='https://code.jquery.com/jquery-3.2.1.min.js')
    script(src='https://code.jquery.com/ui/1.12.1/jquery-ui.js')
    script(src='../js/check.js')
    link(rel='stylesheet', href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css")
    link(rel='stylesheet', type='text/css', href='../css/main.css')
body
    include overview.pug
    #create_menu(name='create_menu')
        sqan  店名：
        input(type='text',style='display:inline-block')#shop_name
        sqan 店家電話
        input(type='text',style='display:inline-block')#shop_phone
        sqan 店家地址
        input(type='text',style='display:inline-block;min-width:200px')#shop_address
        button#go_create_menu 確定
        br
        div(style='text-align:center;min-height:15px;min-width:15px').body_div.plus_kinds 新增種類
        div(style='text-align:center;min-height:15px;min-width:15px').body_div.plus_food 新增餐點
        br
        div.kind_box 
script.
    let menu_num = []
    let food_num = []
    let list_now = 0 
    $('.plus_kinds').click(function(){
        food_num[menu_num.length]=0
        list_now = menu_num.length
        menu_num[menu_num.length]=0
        $('.create_food_menu').hide();
        $("<input/>", {
            "class": "kinds_num kinds"+list_now,
            "id":list_now,
            "style":'min-width:50px;display:inline-block',
            "placeholder":"請輸入種類",
            "text": "種類"+menu_num.length
        }).appendTo(".kind_box");
        $("<div/>", {
            "class": "create_food_menu",
            "id": "menu"+list_now,
        }).appendTo('#create_menu');
    })
    $('.plus_food').click(function(){
        $("<br/>", {
        }).appendTo("#menu"+list_now);
        $("<span/>", {
            "text": "餐點名稱:"
        }).appendTo("#menu"+list_now);
        $("<input/>", {
            "class": "food_name foods"+list_now,
            "id": "menu"+list_now+"_food"+food_num[list_now],
            'style':'display:inline-block',
            "type":"text",
            "value": ""
        }).appendTo("#menu"+list_now);
        $("<span/>", {
            "text": "餐點價格:"
        }).appendTo("#menu"+list_now);
        $("<input/>", {
            "class": "food_price prices"+list_now,
            "id": "menu"+list_now+"_price"+food_num[list_now],
            'style':'display:inline-block',
            "type":"number",
            "value": "",
            "min":"0",
            "max":"100000"
        }).appendTo("#menu"+list_now);
        food_num[list_now]+=1
    })

    $('body').on("click", '.kinds_num', function () {
        $('.create_food_menu').hide();
        list_now =this.id;
        $('#menu'+list_now).show();
    });
    $("form").on("change",".food_price",function () {
        var this_price = document.getElementById(this.id);
        if(check_price_num(this_price.value)==false){
            this_price.style.color='red';
        }else if (check_price_num(this_price.value)==true){
            this_price.style.color='black';
        }
    });
    $("body").on("change","#shop_phone",function () {
        var this_phone = document.getElementById(this.id);
        if(check_phone_num(this_phone.value)==false){
            this_phone.style.color='red';
        }else if (check_phone_num(this_phone.value)==true){
            this_phone.style.color='black';
        }
    }); 

    $('#go_create_menu').click(function(){
        let data = {};
        data.shopName = document.querySelector('#shop_name').value;
        data.shopTel = document.querySelector('#shop_phone').value;
        data.shopAddress = document.querySelector('#shop_address').value;
        data.list =[]
    
        let kinds = document.querySelectorAll(".kinds_num");

        for (let i = 0; i < kinds.length; i++)
        {
            let food = document.querySelectorAll('.foods'+i);
            let price = document.querySelectorAll('.prices'+i);

            let list = {};
            list.type = kinds[i].value;
            list.drink = [];

            for (let x = 0; x < food.length; x++)
            {
                let drink = {};
                drink.name = food[x].value;
                drink.price = price[x].value;
                
                list.drink.push(drink);
            }

            data.list.push(list);
        }

        let a = $.ajax({
            type: 'POST',
            url: "/submitCreateMenu",
            data: data,
            success: function(result){},
            error: function(result){   
                let message = result.responseText;
                message = message.slice(message.search("<pre>Error:")+5);
                message = message.slice(0, message.search("<br>"));
                alert(message);
            }
        });

        a.then(location.href = '\\');
    })